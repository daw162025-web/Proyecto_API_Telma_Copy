<div class="container mt-5 mb-5">
  
  @if (loading()) {
    <div class="d-flex justify-content-center align-items-center" style="height: 50vh;">
      <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } 
  
  @else if (petition(); as pet) {
    <div class="row">
      
      <div class="col-lg-8">
        <h1 class="fw-bold mb-3">{{ pet.title }}</h1>
        
        <div class="mb-4 rounded overflow-hidden shadow-sm">
          <img [src]="getImageUrl()" 
                class="img-fluid w-100" 
                style="max-height: 400px; object-fit: cover;" 
                alt="{{ pet.title }}">
        </div>

        <div class="d-flex align-items-center mb-4 text-muted">
          <i class="bi bi-person-circle fs-4 me-2"></i>
          <div>
            <small>Started by <strong>{{ pet.user?.name }}</strong></small>
            <br>
            <small>Directed to: <strong>{{ pet.destinatary }}</strong></small>
          </div>
          
          @if (pet.category) {
            <span class="badge bg-secondary ms-auto">{{ pet.category.name }}</span>
          }
        </div>

        <hr>

        <div class="mt-4">
          <p class="lead" style="white-space: pre-line;">{{ pet.description }}</p>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card shadow-sm border-0 sticky-top" style="top: 2rem; z-index: 1;">
          <div class="card-body p-4">
            
            <div class="mb-2">
              <span class="fw-bold fs-5">{{ pet.signeds || 0 }}</span> 
              <span class="text-muted"> people have signed</span>
            </div>
            
            <div class="progress mb-4" style="height: 10px;">
              <div class="progress-bar bg-danger" 
                   role="progressbar" 
                   [style.width.%]="((pet.signeds || 0) * 100) / 1000" 
                   aria-valuenow="pet.signeds" aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>

            @if (currentUserId() === pet.user_id) {
              <div class="d-grid gap-2">
                <div class="alert alert-info text-center small mb-2">
                  <i class="bi bi-info-circle"></i> You are the creator
                </div>
                
                <a [routerLink]="['/petitions/edit', pet.id]" class="btn btn-outline-dark">
                  <i class="bi bi-pencil-square"></i> Edit Petition
                </a>
                
                <button (click)="delete()" class="btn btn-outline-danger">
                  <i class="bi bi-trash"></i> Delete Petition
                </button>
              </div>
            } @else {
              <div class="d-grid gap-2">
                <button class="btn btn-danger btn-lg fw-bold">
                  Sign this petition!
                </button>
                <p class="text-muted small text-center mt-2">
                  Your signature can help change the world.
                </p>
              </div>
            }

          </div>
        </div>
      </div>

    </div>
  } 
  
  @else {
    <div class="alert alert-warning text-center mt-5">
      Petition not found.
      <br>
      <a routerLink="/petitions" class="btn btn-link">Back to list</a>
    </div>
  }
</div>